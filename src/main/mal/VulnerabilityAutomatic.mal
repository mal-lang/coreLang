/*
 * Copyright 2019-2020 coreLang contributors <https://mal-lang.org/coreLang/contributors.html>
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/*
 *  This MAL specification is heavily based on awsLang.
 */


category Vulnerability {

  abstract asset AutomaticallyModeledVulnerability extends Vulnerability
  {

  }

  abstract asset AutomaticLowComplexityVulnerability extends AutomaticallyModeledVulnerability
  {
    & abuse [Exponential(1.0)]
      user info: "The attacker is attempting to abuse a vulnerability in an application."
      -> exploits.attemptExploit
  }

  abstract asset AutomaticHighComplexityVulnerability extends AutomaticallyModeledVulnerability
  {
    & abuse [Exponential(0.01)]
      user info: "The attacker is attempting to abuse a vulnerability in an application."
      -> exploits.attemptExploit
  }

  asset LLNNVulnerability extends AutomaticLowComplexityVulnerability
    user info: "Attack Vector: Local, Attack Complexity: Low, Privileges Required: None, User Interaction: None"
  {
  }

  asset LLNRVulnerability extends AutomaticLowComplexityVulnerability
    user info: "Attack Vector: Local, Attack Complexity: Low, Privileges Required: None, User Interaction: Required"
  {
    # userInteracts [Bernoulli(0.5)]
      -> abuse
  }

  asset LLLNVulnerability extends AutomaticLowComplexityVulnerability
    user info: "Attack Vector: Local, Attack Complexity: Low, Privileges Required: Low, User Interaction: None"
  {
  }

  asset LLLRVulnerability extends AutomaticLowComplexityVulnerability
    user info: "Attack Vector: Local, Attack Complexity: Low, Privileges Required: Low, User Interaction: Required"
  {
    # userInteracts [Bernoulli(0.5)]
      -> abuse
  }

  asset LLHNVulnerability extends AutomaticLowComplexityVulnerability
    user info: "Attack Vector: Local, Attack Complexity: Low, Privileges Required: High, User Interaction: None"
  {
  }

  asset LLHRVulnerability extends AutomaticLowComplexityVulnerability
    user info: "Attack Vector: Local, Attack Complexity: Low, Privileges Required: High, User Interaction: Required"
  {
    # userInteracts [Bernoulli(0.5)]
      -> abuse
  }

  asset NLNNVulnerability extends AutomaticLowComplexityVulnerability
    user info: "Attack Vector: Network, Attack Complexity: Low, Privileges Required: None, User Interaction: None"
  {
  }

  asset NLNRVulnerability extends AutomaticLowComplexityVulnerability
    user info: "Attack Vector: Network, Attack Complexity: Low, Privileges Required: None, User Interaction: Required"
  {
    # userInteracts [Bernoulli(0.5)]
      -> abuse
  }

  asset NLLNVulnerability extends AutomaticLowComplexityVulnerability
    user info: "Attack Vector: Network, Attack Complexity: Low, Privileges Required: Low, User Interaction: None"
  {
  }

  asset NLLRVulnerability extends AutomaticLowComplexityVulnerability
    user info: "Attack Vector: Network, Attack Complexity: Low, Privileges Required: Low, User Interaction: Required"
  {
    # userInteracts [Bernoulli(0.5)]
      -> abuse
  }

  asset NLHNVulnerability extends AutomaticLowComplexityVulnerability
    user info: "Attack Vector: Network, Attack Complexity: Low, Privileges Required: High, User Interaction: None"
  {
  }

  asset NLHRVulnerability extends AutomaticLowComplexityVulnerability
    user info: "Attack Vector: Network, Attack Complexity: Low, Privileges Required: High, User Interaction: Required"
  {
    # userInteracts [Bernoulli(0.5)]
      -> abuse
  }

  asset LHNNVulnerability extends AutomaticHighComplexityVulnerability
    user info: "Attack Vector: Local, Attack Complexity: High, Privileges Required: None, User Interaction: None"
  {
  }

  asset LHNRVulnerability extends AutomaticHighComplexityVulnerability
    user info: "Attack Vector: Local, Attack Complexity: High, Privileges Required: None, User Interaction: Required"
  {
    # userInteracts [Bernoulli(0.5)]
      -> abuse
  }

  asset LHLNVulnerability extends AutomaticHighComplexityVulnerability
    user info: "Attack Vector: Local, Attack Complexity: High, Privileges Required: Low, User Interaction: None"
  {
  }

  asset LHLRVulnerability extends AutomaticHighComplexityVulnerability
    user info: "Attack Vector: Local, Attack Complexity: High, Privileges Required: Low, User Interaction: Required"
  {
    # userInteracts [Bernoulli(0.5)]
      -> abuse
  }

  asset LHHNVulnerability extends AutomaticHighComplexityVulnerability
    user info: "Attack Vector: Local, Attack Complexity: High, Privileges Required: High, User Interaction: None"
  {
  }

  asset LHHRVulnerability extends AutomaticHighComplexityVulnerability
    user info: "Attack Vector: Local, Attack Complexity: High, Privileges Required: High, User Interaction: Required"
  {
    # userInteracts [Bernoulli(0.5)]
      -> abuse
  }

  asset NHNNVulnerability extends AutomaticHighComplexityVulnerability
    user info: "Attack Vector: Network, Attack Complexity: High, Privileges Required: None, User Interaction: None"
  {
  }

  asset NHNRVulnerability extends AutomaticHighComplexityVulnerability
    user info: "Attack Vector: Network, Attack Complexity: High, Privileges Required: None, User Interaction: Required"
  {
    # userInteracts [Bernoulli(0.5)]
      -> abuse
  }

  asset NHLNVulnerability extends AutomaticHighComplexityVulnerability
    user info: "Attack Vector: Network, Attack Complexity: High, Privileges Required: Low, User Interaction: None"
  {
  }

  asset NHLRVulnerability extends AutomaticHighComplexityVulnerability
    user info: "Attack Vector: Network, Attack Complexity: High, Privileges Required: Low, User Interaction: Required"
  {
    # userInteracts [Bernoulli(0.5)]
      -> abuse
  }

  asset NHHNVulnerability extends AutomaticHighComplexityVulnerability
    user info: "Attack Vector: Network, Attack Complexity: High, Privileges Required: High, User Interaction: None"
  {
  }

  asset NHHRVulnerability extends AutomaticHighComplexityVulnerability
    user info: "Attack Vector: Network, Attack Complexity: High, Privileges Required: High, User Interaction: Required"
  {
    # userInteracts [Bernoulli(0.5)]
      -> abuse
  }

}

category Exploit {

  abstract asset AutomaticExploit extends Exploit
    developer info: "Each CVSS-based (automatic) vulnerability is associated with an exploit that specifies the types of impact."
  {
    let allVulnerableSoftware = vulnerability.application \/ vulnerability.softwareProduct.softApplications

    | attemptExploit
      -> impact

  }

  asset HHHExploit extends AutomaticExploit
    user info: "Confidentiality Impact: High, Integrity Impact: High, Availability Impact: High. An HHH exploit is assumed to grant the attacker full control of the vulnerable application's executing code."
  {
    | impact
      user info: "This exploit is assumed to grant the attacker full control of the vulnerable application's executing code"
      -> allVulnerableSoftware().codeExecution
  }

  asset HHLExploit extends AutomaticExploit
    user info: "Confidentiality Impact: High, Integrity Impact: High, Availability Impact: Low"
  {
    | impact
      user info: "Confidentiality Impact: High, Integrity Impact: High, Availability Impact: Low"
      -> allVulnerableSoftware().read,
         allVulnerableSoftware().modify,
         lowImpact

    | lowImpact @hidden [Bernoulli(0.5)]
      -> allVulnerableSoftware().deny
  }

  asset HHNExploit extends AutomaticExploit
    user info: "Confidentiality Impact: High, Integrity Impact: High, Availability Impact: None"
  {
    | impact
      user info: "Confidentiality Impact: High, Integrity Impact: High, Availability Impact: None"
      -> allVulnerableSoftware().read,
         allVulnerableSoftware().modify
  }

  asset HLHExploit extends AutomaticExploit
    user info: "Confidentiality Impact: High, Integrity Impact: Low, Availability Impact: High"
  {
    | impact
      user info: "Confidentiality Impact: High, Integrity Impact: Low, Availability Impact: High"
      -> allVulnerableSoftware().read,
         allVulnerableSoftware().deny,
         lowImpact

    | lowImpact @hidden [Bernoulli(0.5)]
      -> allVulnerableSoftware().modify
  }

  asset HLLExploit extends AutomaticExploit
    user info: "Confidentiality Impact: High, Integrity Impact: Low, Availability Impact: Low"
  {
    | impact
      user info: "Confidentiality Impact: High, Integrity Impact: Low, Availability Impact: Low"
      -> allVulnerableSoftware().read,
         lowImpact

    | lowImpact @hidden [Bernoulli(0.5)]
      -> allVulnerableSoftware().modify,
         allVulnerableSoftware().deny
  }

  asset HLNExploit extends AutomaticExploit
    user info: "Confidentiality Impact: High, Integrity Impact: Low, Availability Impact: None"
  {
    | impact
      user info: "Confidentiality Impact: High, Integrity Impact: Low, Availability Impact: None"
      -> allVulnerableSoftware().read,
         lowImpact

    | lowImpact @hidden [Bernoulli(0.5)]
      -> allVulnerableSoftware().modify
  }

  asset HNHExploit extends AutomaticExploit
    user info: "Confidentiality Impact: High, Integrity Impact: None, Availability Impact: High"
  {
    | impact
      user info: "Confidentiality Impact: High, Integrity Impact: None, Availability Impact: High"
      -> allVulnerableSoftware().read,
         allVulnerableSoftware().deny
  }

  asset HNLExploit extends AutomaticExploit
    user info: "Confidentiality Impact: High, Integrity Impact: None, Availability Impact: Low"
  {
    | impact
      user info: "Confidentiality Impact: High, Integrity Impact: None, Availability Impact: Low"
      -> allVulnerableSoftware().read,
         lowImpact

    | lowImpact @hidden [Bernoulli(0.5)]
      -> allVulnerableSoftware().deny
  }

  asset HNNExploit extends AutomaticExploit
    user info: "Confidentiality Impact: High, Integrity Impact: None, Availability Impact: None"
  {
    | impact
      user info: "Confidentiality Impact: High, Integrity Impact: None, Availability Impact: None"
      -> allVulnerableSoftware().read
  }

  asset LHHExploit extends AutomaticExploit
    user info: "Confidentiality Impact: Low, Integrity Impact: High, Availability Impact: High"
  {
    | impact
      user info: "Confidentiality Impact: Low, Integrity Impact: High, Availability Impact: High"
      -> allVulnerableSoftware().modify,
         allVulnerableSoftware().deny,
         lowImpact

    | lowImpact @hidden [Bernoulli(0.5)]
      -> allVulnerableSoftware().read
  }

  asset LHLExploit extends AutomaticExploit
    user info: "Confidentiality Impact: Low, Integrity Impact: High, Availability Impact: Low"
  {
    | impact
      user info: "Confidentiality Impact: Low, Integrity Impact: High, Availability Impact: Low"
      -> allVulnerableSoftware().modify,
         lowImpact

    | lowImpact @hidden [Bernoulli(0.5)]
      -> allVulnerableSoftware().read,
         allVulnerableSoftware().deny
  }

  asset LHNExploit extends AutomaticExploit
    user info: "Confidentiality Impact: Low, Integrity Impact: High, Availability Impact: None"
  {
    | impact
      user info: "Confidentiality Impact: Low, Integrity Impact: High, Availability Impact: None"
      -> allVulnerableSoftware().modify,
         lowImpact

    | lowImpact @hidden [Bernoulli(0.5)]
      -> allVulnerableSoftware().read
  }

  asset LLHExploit extends AutomaticExploit
    user info: "Confidentiality Impact: Low, Integrity Impact: Low, Availability Impact: High"
  {
    | impact
      user info: "Confidentiality Impact: Low, Integrity Impact: Low, Availability Impact: High"
      -> allVulnerableSoftware().deny,
         lowImpact

    | lowImpact @hidden [Bernoulli(0.5)]
      -> allVulnerableSoftware().read,
         allVulnerableSoftware().modify
  }

  asset LLLExploit extends AutomaticExploit
    user info: "Confidentiality Impact: Low, Integrity Impact: Low, Availability Impact: Low"
  {
    | impact
      user info: "Confidentiality Impact: Low, Integrity Impact: Low, Availability Impact: Low"
      -> lowImpact

    | lowImpact @hidden [Bernoulli(0.5)]
      -> allVulnerableSoftware().read,
         allVulnerableSoftware().modify,
         allVulnerableSoftware().deny
  }

  asset LLNExploit extends AutomaticExploit
    user info: "Confidentiality Impact: Low, Integrity Impact: Low, Availability Impact: None"
  {
    | impact
      user info: "Confidentiality Impact: Low, Integrity Impact: Low, Availability Impact: None"
      -> lowImpact

    | lowImpact @hidden [Bernoulli(0.5)]
      -> allVulnerableSoftware().read,
         allVulnerableSoftware().modify
  }

  asset LNHExploit extends AutomaticExploit
    user info: "Confidentiality Impact: Low, Integrity Impact: None, Availability Impact: High"
  {
    | impact
      user info: "Confidentiality Impact: Low, Integrity Impact: None, Availability Impact: High"
      -> allVulnerableSoftware().deny,
         lowImpact

    | lowImpact @hidden [Bernoulli(0.5)]
      -> allVulnerableSoftware().read
  }

  asset LNLExploit extends AutomaticExploit
    user info: "Confidentiality Impact: Low, Integrity Impact: None, Availability Impact: Low"
  {
    | impact
      user info: "Confidentiality Impact: Low, Integrity Impact: None, Availability Impact: Low"
      -> lowImpact

    | lowImpact @hidden [Bernoulli(0.5)]
      -> allVulnerableSoftware().read,
         allVulnerableSoftware().deny
  }

  asset LNNExploit extends AutomaticExploit
    user info: "Confidentiality Impact: Low, Integrity Impact: None, Availability Impact: None"
  {
    | impact
      user info: "Confidentiality Impact: Low, Integrity Impact: None, Availability Impact: None"
      -> lowImpact

    | lowImpact @hidden [Bernoulli(0.5)]
      -> allVulnerableSoftware().read
  }

  asset NHHExploit extends AutomaticExploit
    user info: "Confidentiality Impact: None, Integrity Impact: High, Availability Impact: High"
  {
    | impact
      user info: "Confidentiality Impact: None, Integrity Impact: High, Availability Impact: High"
      -> allVulnerableSoftware().modify,
         allVulnerableSoftware().deny
  }

  asset NHLExploit extends AutomaticExploit
    user info: "Confidentiality Impact: None, Integrity Impact: High, Availability Impact: Low"
  {
    | impact
      user info: "Confidentiality Impact: None, Integrity Impact: High, Availability Impact: Low"
      -> allVulnerableSoftware().modify,
         lowImpact

    | lowImpact @hidden [Bernoulli(0.5)]
      -> allVulnerableSoftware().deny
  }

  asset NHNExploit extends AutomaticExploit
    user info: "Confidentiality Impact: None, Integrity Impact: High, Availability Impact: None"
  {
    | impact
      user info: "Confidentiality Impact: None, Integrity Impact: High, Availability Impact: None"
      -> allVulnerableSoftware().modify
  }

  asset NLHExploit extends AutomaticExploit
    user info: "Confidentiality Impact: None, Integrity Impact: Low, Availability Impact: High"
  {
    | impact
      user info: "Confidentiality Impact: None, Integrity Impact: Low, Availability Impact: High"
      -> allVulnerableSoftware().deny,
         lowImpact

    | lowImpact @hidden [Bernoulli(0.5)]
      -> allVulnerableSoftware().modify
  }

  asset NLLExploit extends AutomaticExploit
    user info: "Confidentiality Impact: None, Integrity Impact: Low, Availability Impact: Low"
  {
    | impact
      user info: "Confidentiality Impact: None, Integrity Impact: Low, Availability Impact: Low"
      -> lowImpact

    | lowImpact @hidden [Bernoulli(0.5)]
      -> allVulnerableSoftware().modify,
         allVulnerableSoftware().deny
  }

  asset NLNExploit extends AutomaticExploit
    user info: "Confidentiality Impact: None, Integrity Impact: Low, Availability Impact: None"
  {
    | impact
      user info: "Confidentiality Impact: None, Integrity Impact: Low, Availability Impact: Low"
      -> lowImpact

    | lowImpact @hidden [Bernoulli(0.5)]
      -> allVulnerableSoftware().modify
  }

  asset NNHExploit extends AutomaticExploit
    user info: "Confidentiality Impact: None, Integrity Impact: None, Availability Impact: High"
  {
    | impact
      user info: "Confidentiality Impact: None, Integrity Impact: None, Availability Impact: High"
      -> allVulnerableSoftware().deny
  }

  asset NNLExploit extends AutomaticExploit
    user info: "Confidentiality Impact: None, Integrity Impact: None, Availability Impact: Low"
  {
    | impact
      user info: "Confidentiality Impact: None, Integrity Impact: None, Availability Impact: Low"
      -> lowImpact

    | lowImpact @hidden [Bernoulli(0.5)]
      -> allVulnerableSoftware().deny
  }
}
