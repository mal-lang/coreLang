/*
 * Copyright 2019-2021 coreLang contributors <https://mal-lang.org/coreLang/contributors.html>
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

category Vulnerability {

  asset SoftwareVulnerability extends Vulnerability
    user info: "A vulnerability that affects software (i.e. Applications or SoftwareProducts)."
  {
    # networkAccessRequired @suppress [Disabled]
      user info: "Network access is required to abuse the vulnerability."
      modeler info: "https://www.first.org/cvss/v3.1/specification-document#2-1-1-Attack-Vector-AV"
      ->  networkAccessAchieved,
          softwareProduct.softApplications.softwareProductVulnerabilityNetworkAccessAchieved

    # localAccessRequired @suppress [Disabled]
      user info: "Local access is required to abuse the vulnerability."
      modeler info: "https://www.first.org/cvss/v3.1/specification-document#2-1-1-Attack-Vector-AV"
      ->  localAccessAchieved,
          softwareProduct.softApplications.softwareProductVulnerabilityLocalAccessAchieved

    # physicalAccessRequired @suppress [Disabled]
      user info: "Physical access is required to abuse the vulnerability."
      modeler info: "https://www.first.org/cvss/v3.1/specification-document#2-1-1-Attack-Vector-AV"
      ->  physicalAccessAchieved,
          softwareProduct.softApplications.softwareProductVulnerabilityPhysicalAccessAchieved

    # lowPrivilegesRequired @suppress [Disabled]
      user info: "Low privileges are required to abuse the vulnerability."
      modeler info: "https://www.first.org/cvss/v3.1/specification-document#2-1-3-Privileges-Required-PR"
      ->  lowPrivilegesAchieved,
          softwareProduct.softApplications.softwareProductVulnerabilityLowPrivilegesAchieved

    # highPrivilegesRequired @suppress [Disabled]
      user info: "High privileges are required to abuse the vulnerability."
      modeler info: "https://www.first.org/cvss/v3.1/specification-document#2-1-3-Privileges-Required-PR"
      ->  highPrivilegesAchieved,
          softwareProduct.softApplications.softwareProductVulnerabilityHighPrivilegesAchieved

    # userInteractionRequired @suppress [Disabled]
      user info: "Some exploits require user interaction. This defense should specify the probability of such interaction on the given application."
      modeler info: "https://www.first.org/cvss/v3.1/specification-document#2-1-4-User-Interaction-UI"
      ->  userInteractionAchieved,
          softwareProduct.softApplications.softwareProductVulnerabilityUserInteractionAchieved

    # confidentialityImpactLimitations @suppress [Disabled]
      user info: "Limits the impact on confidentiality of the vulnerability."
      modeler info: "https://www.first.org/cvss/v3.1/specification-document#2-3-1-Confidentiality-C"
      ->  read

    # availabilityImpactLimitations @suppress [Disabled]
      user info: "Limits the impact on availability of the vulnerability."
      modeler info: "https://www.first.org/cvss/v3.1/specification-document#2-3-3-Availability-A"
      ->  deny

    # integrityImpactLimitations @suppress [Disabled]
      user info: "Limits the impact on integrity of the vulnerability."
      modeler info: "https://www.first.org/cvss/v3.1/specification-document#2-3-2-Integrity-I"
      ->  modify

    # highComplexityExploitRequired @suppress [Disabled]
      user info: "The vulnerability relies on a high complexity exploit that requires the attacker to expend additional effort (time) in order to successfully make use of it."
      developer info: "A vulnerability that has high complexity due to its intrinsic properties that are beyond the attacker's control."
      modeler info: "https://www.first.org/cvss/v3.1/specification-document#2-1-2-Attack-Complexity-AC"
      ->  exploitTrivially

    | networkAccessAchieved @hidden
      developer info: "Intermediate attack step to model network access requirement."
      ->  abuse

    | localAccessAchieved @hidden
      developer info: "Intermediate attack step to model local access requirement."
      ->  abuse

    | physicalAccessAchieved @hidden
      developer info: "Intermediate attack step to model physical access requirement."
      ->  abuse

    | lowPrivilegesAchieved @hidden
      developer info: "Intermediate attack step to model low privileges requirement."
      ->  abuse

    | highPrivilegesAchieved @hidden
      developer info: "Intermediate attack step to model high privileges requirement."
      ->  abuse

    | userInteractionAchieved @hidden
      developer info: "Intermediate attack step to model user interaction defense."
      ->  abuse

    & read
      user info: "The attacker can read some or all of the associated applications's code and data."
      ->  application.read,
          softwareProduct.readApplications

    & modify
     user info: "The attacker can modify some or all of the associated application's data and/or source code."
      ->  application.modify,
          softwareProduct.modifyApplications

    & deny
      user info: "Denial-of-Service attack is an attack in which an application is rendered unavailable to its intended users by temporarily or indefinitely disrupting it."
      ->  application.deny,
          softwareProduct.denyApplications

    | attemptExploit @Override
      user info: "This is the attack step that must be reached in order for a vulnerability to be able to be exploited. This is also the single checkpoint for all vulnerabilities to model hindrances to employing an exploit."
      ->  exploitTrivially,
          exploitWithEffort

    & exploitTrivially
      user info: "The exploit is trivial and requires insignificant effort from the attacker in order to be successful."
      -> exploit

    & exploitWithEffort [Exponential(0.01)]
      user info: "The attacker must expend effort in order to successfully exploit the vulnerability."
      developer info: "The distribution chosen here may be scientifically sound, but needs to be reevaluated to ensure that this is the case."
      -> exploit

    | impact
      user info: "The actual impact caused by successfully exploiting the vulnerability."
      -> read,
         modify,
         deny
  }
}

associations {
  SoftwareVulnerability               [vulnerabilities]   * <-- ApplicationVulnerability --> 0..1 [application]     Application
      developer info: "Every Application can also be connected to any Vulnerability."
  SoftwareVulnerability    [softProductVulnerabilities]   * <-- ApplicationVulnerability --> 0..1 [softwareProduct] SoftwareProduct
      developer info: "Every SoftwareProduct can also be connected to any Vulnerability."
}
