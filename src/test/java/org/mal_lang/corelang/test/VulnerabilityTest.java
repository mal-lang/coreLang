package org.mal_lang.corelang.test;

import core.Attacker;
import org.junit.jupiter.api.Test;

public class VulnerabilityTest extends CoreLangTest {
    private static class VulnerabilityTestModel {
        public SoftwareVulnerability vuln;

        public VulnerabilityTestModel(boolean interaction, boolean remove) {
            vuln = new SoftwareVulnerability("vulnerability", remove, false, false, false, false, interaction, false, false, false, false, false);
        }

        public void addAttacker(Attacker attacker) {
            attacker.addAttackPoint(vuln.attemptAbuse);
        }
  }

    @Test
    public void testAttemptAbuseVulnerability() {
        printTestName(Thread.currentThread().getStackTrace()[1].getMethodName());
        var model = new VulnerabilityTestModel(false, false);

        var attacker = new Attacker();
        model.addAttacker(attacker);
        attacker.attack();

        model.vuln.abuse.assertCompromisedInstantaneously();
        model.vuln.impact.assertCompromisedInstantaneously();
    }

    @Test
    public void testAttemptAbuseVulnerabilityRemoved() {
        printTestName(Thread.currentThread().getStackTrace()[1].getMethodName());
        var model = new VulnerabilityTestModel(false, true);

        var attacker = new Attacker();
        model.addAttacker(attacker);
        attacker.attack();

        model.vuln.abuse.assertUncompromised();
        model.vuln.impact.assertUncompromised();

    }

    @Test
    public void testAttemptAbuseVulnerabilityUserInteraction() {
        printTestName(Thread.currentThread().getStackTrace()[1].getMethodName());
        var model = new VulnerabilityTestModel(true, false);

        var attacker = new Attacker();
        model.addAttacker(attacker);
        attacker.attack();

        model.vuln.abuse.assertUncompromised();
        model.vuln.impact.assertUncompromised();

    }

}
